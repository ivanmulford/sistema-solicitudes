<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Solicitud de Compras</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

    <!-- üîπ Barra superior -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <span class="navbar-brand">Sistema de Solicitudes</span>
            <div class="d-flex">
                <a href="{{ url_for('logout') }}" class="btn btn-danger btn-sm">Cerrar sesi√≥n</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">

        <!-- Formulario de solicitud -->
        <div class="card shadow">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">Nueva Solicitud</h5>
            </div>
            <div class="card-body">
                <form method="POST">

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Sede</label>
                            <select name="sede" class="form-select" required>
                                <option value="">Seleccione una sede</option>
                                <option value="Santamarta">Santamarta</option>
                                <option value="Medell√≠n">Medell√≠n</option>
                                <option value="Barranquilla">Barranquilla</option>
                                <option value="Cali">Cali</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Fecha</label>
                            <input type="date" name="fecha" class="form-control" required>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Proceso</label>
                            <select name="proceso" class="form-select" required>
                                <option value="">Seleccione un proceso</option>
                                <option value="Compras">Compras</option>
                                <option value="Hogares Sustitutos">Hogares Sustitutos</option>
                                <option value="Intervenci√≥n y Apoyo">Intervenci√≥n y Apoyo</option>
                                <option value="Recursos Humanos">Recursos Humanos</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Proyecto</label>
                            <select name="proyecto" class="form-select">
                                <option value="">Seleccione un proyecto</option>
                                <option value="Infraestructura">Infraestructura</option>
                                <option value="Tecnolog√≠a">Tecnolog√≠a</option>
                                <option value="Capacitaci√≥n">Capacitaci√≥n</option>
                                <option value="Operaciones">Operaciones</option>
                            </select>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Descripci√≥n</label>
                        <textarea name="descripcion" class="form-control" rows="2" required></textarea>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label class="form-label">Monto</label>
                            <input type="number" name="monto" class="form-control" step="0.01">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Prioridad</label>
                            <select name="prioridad" class="form-select" required>
                                <option value="alta">Alta</option>
                                <option value="media">Media</option>
                                <option value="baja">Baja</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Proveedor</label>
                            <input type="text" name="proveedor" class="form-control">
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Justificaci√≥n</label>
                        <textarea name="justificacion" class="form-control" rows="2"></textarea>
                    </div>

                    <!-- √çtems -->
                    <h6 class="mt-4">√çtems de Solicitud</h6>
                    <table class="table table-bordered" id="tabla-items">
                        <thead class="table-light">
                            <tr>
                                <th style="width: 15%">Cantidad</th>
                                <th>Descripci√≥n</th>
                                <th style="width: 10%">Acci√≥n</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><input type="number" name="cantidad[]" class="form-control" required></td>
                                <td><input type="text" name="item_descripcion[]" class="form-control" required></td>
                                <td><button type="button" class="btn btn-danger btn-sm" onclick="eliminarFila(this)">‚úñ</button></td>
                            </tr>
                        </tbody>
                    </table>
                    <button type="button" class="btn btn-success btn-sm" onclick="agregarFila()">+ Agregar √çtem</button>

                    <div class="mt-4">
                        <button type="submit" class="btn btn-primary">Enviar Solicitud</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Tabla de solicitudes del usuario -->
        <div class="card shadow mt-4">
            <div class="card-header bg-secondary text-white">
                <h5 class="mb-0">Mis Solicitudes</h5>
            </div>
            <div class="card-body">
                <table class="table table-hover">
                    <thead class="table-light">
                        <tr>
                            <th>ID</th>
                            <th>Fecha</th>
                            <th>Descripci√≥n</th>
                            <th>Proyecto</th>
                            <th>Monto</th>
                            <th>Estado</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for sol in solicitudes %}
                        <tr>
                            <td>{{ sol.id }}</td>
                            <td>{{ sol.fecha }}</td>
                            <td>{{ sol.descripcion }}</td>
                            <td>{{ sol.proyecto }}</td>
                            <td>{{ sol.monto }}</td>
                            <td>
                                {% if sol.estado == "pendiente" %}
                                    <span class="badge bg-warning text-dark">{{ sol.estado }}</span>
                                {% elif sol.estado == "aprobado" %}
                                    <span class="badge bg-success">{{ sol.estado }}</span>
                                {% elif sol.estado == "rechazado" %}
                                    <span class="badge bg-danger">{{ sol.estado }}</span>
                                {% else %}
                                    <span class="badge bg-secondary">{{ sol.estado }}</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        function agregarFila() {
            const tabla = document.getElementById("tabla-items").getElementsByTagName('tbody')[0];
            const nuevaFila = tabla.insertRow();
            nuevaFila.innerHTML = `
                <td><input type="number" name="cantidad[]" class="form-control" required></td>
                <td><input type="text" name="item_descripcion[]" class="form-control" required></td>
                <td><button type="button" class="btn btn-danger btn-sm" onclick="eliminarFila(this)">‚úñ</button></td>
            `;
        }

        function eliminarFila(boton) {
            const fila = boton.closest("tr");
            fila.remove();
        }
    </script>
</body>
</html>
